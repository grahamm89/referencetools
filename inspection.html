<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Site Chemical & Equipment Inspection</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body{padding-bottom:4rem;}
  .tab-content{margin-top:1.5rem;}
  textarea{resize:vertical;}
  .sticky-btns{position:fixed;bottom:1rem;right:1rem;z-index:1000;}
  .qa-text{font-family:monospace;min-height:200px;white-space:pre-wrap;}
</style>
</head>
<body>
<div class="container my-3">

  <h1 class="h3 text-center mb-4">Site Chemical &amp; Equipment Inspection</h1>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="mainTabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#chem" type="button">Chemical Dispensing</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#eco" type="button">Ecoshot Volumes</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#dish" type="button">Dishwasher &amp; Water</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#laundry" type="button">Laundry</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#stock" type="button">Storeroom Stock</button></li>
  </ul>

  <div class="tab-content">

    <!-- Chemical Dispensing -->
    <div class="tab-pane fade show active" id="chem" role="tabpanel">
      <h2 class="h5 mt-3">Chemical Dispensing Equipment</h2>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="doseOK">
        <label class="form-check-label" for="doseOK">All dosing equipment functioning &amp; delivering correct dosage</label>
      </div>

      <div class="row mt-2">
        <div class="col-12">
          <label for="quat" class="form-label">Quat test (D10) ppm result</label>
          <input type="number" class="form-control" id="quat" placeholder="ppm">
        </div>
      </div>

      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" id="approvedSystems">
        <label class="form-check-label" for="approvedSystems">All chemicals connected to approved systems</label>
      </div>

      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" id="enhancePelican">
        <label class="form-check-label" for="enhancePelican">Enhance dosed via pelican pump</label>
      </div>

      <label class="form-label mt-3">Report faulty / manual dosing setups (photo upload):</label>
      <input class="form-control mb-3" type="file" multiple accept="image/*">
      <textarea class="form-control" id="chemComments" rows="3" placeholder="Comments / actions taken"></textarea>
    </div>

    <!-- Ecoshot -->
    <div class="tab-pane fade" id="eco" role="tabpanel">
      <h2 class="h5 mt-3">Ecoshot Dispensing Volumes</h2>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead class="table-light">
            <tr><th>Location</th><th>Product</th><th>Bottle&nbsp;Dose (ml)</th><th>Bucket&nbsp;Dose (ml)</th></tr>
          </thead>
          <tbody id="ecoTable"></tbody>
        </table>
      </div>
      <button class="btn btn-outline-secondary" onclick="addEcoRow()">Add&nbsp;Row</button>
    </div>

    <!-- Dishwasher -->
    <div class="tab-pane fade" id="dish" role="tabpanel">
      <h2 class="h5 mt-3">Dishwasher Titration &amp; Water Hardness</h2>
      <p class="small">Fill in the results and attach photos where relevant.</p>
      <div id="dishList"></div>
      <button class="btn btn-outline-secondary mb-3" onclick="addDishRecord()">Add&nbsp;Dishwasher</button>
    </div>

    <!-- Laundry -->
    <div class="tab-pane fade" id="laundry" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mt-3">
        <h2 class="h5 mb-0">Laundry Equipment &amp; Dosing Monitoring</h2>
        <button class="btn btn-sm btn-link" data-bs-toggle="modal" data-bs-target="#l5000Modal">L5000&nbsp;Reset&nbsp;Instructions</button>
      </div>

      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" id="laundryUnitOK">
        <label class="form-check-label" for="laundryUnitOK">Laundry dosing units functioning correctly</label>
      </div>

      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" id="laundryDoseRight">
        <label class="form-check-label" for="laundryDoseRight">Dosing matches site water hardness</label>
      </div>

      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" id="waterHardnessDone">
        <label class="form-check-label" for="waterHardnessDone">Water hardness checked / recorded</label>
      </div>

      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" id="washCountReset">
        <label class="form-check-label" for="washCountReset">Current wash count recorded / reset</label>
      </div>

      <label class="form-label mt-3">Comments / actions:</label>
      <textarea class="form-control" id="laundryComments" rows="3"></textarea>
    </div>

    <!-- Stock -->
    <div class="tab-pane fade" id="stock" role="tabpanel">
      <h2 class="h5 mt-3">Storeroom Stock Check</h2>
      <p class="small text-muted mb-1">Enter quantities, then copy or export.</p>
      <div class="table-responsive">
        <table class="table table-sm align-middle" id="stockTable">
          <thead class="table-light">
            <tr><th>SKU</th><th>Description</th><th style="width:120px">Quantity</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-secondary" onclick="copyStock()">Copy&nbsp;to&nbsp;Clipboard</button>
        <button class="btn btn-outline-secondary" onclick="downloadCSV()">Export&nbsp;CSV</button>
      </div>
    </div>

  </div><!-- /tab-content -->
</div><!-- /container -->

<!-- Sticky copy summary button -->
<div class="sticky-btns">
  <button class="btn btn-primary shadow" onclick="openQASummary()">üìã Copy&nbsp;Q&amp;A&nbsp;Summary</button>
</div>

<!-- L5000 modal -->
<div class="modal fade" id="l5000Modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">L5000 Wash Count Reset Instructions</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
<pre style="white-space:pre-wrap">
PASSWORD
Press & hold MENU 5 s ‚Üí Password screen ‚Äú???‚Äù
Use + and CURSOR to enter 8-9-0
Press MENU twice ‚Üí Wash Count screen

RESETTING THE WASH COUNTS
F1 shows wash counts since last reset.
Hold ACTION key ‚Üí resets that formula to 000.
Press + to advance to F2, repeat for all formulas in use.

RETURNING TO HOME SCREEN
MUST return to Home before starting washer or NO PRODUCT will dose.
Option 1: Power-cycle (switch under dispenser, right-hand side), wait green light out, count to 10, power back on ‚Üí Home.
Option 2: Press & hold MENU ~5 s to return directly to Home.
</pre>
      </div>
    </div>
  </div>
</div>

<!-- Q&A summary modal -->
<div class="modal fade" id="qaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Q&amp;A Summary</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="qaText" class="form-control qa-text" readonly></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="copyQA()">Copy to Clipboard</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ===========================================================
   Data templates
   =========================================================== */
const ecoDefaults=[
  {loc:"Housekeeping",prod:"Oxivir",b:"15",bucket:"20"},
  {loc:"Housekeeping",prod:"Good Sense Breakdown",b:"15",bucket:""},
  {loc:"Kitchen",prod:"Suma D10",b:"10",bucket:""},
  {loc:"Kitchen",prod:"Suma D3.5",b:"10",bucket:"20"}
];

const stockList=`7508226,Suma Star D1 2x5L W1779+
100862178,Suma Break up D3.5 2x5L W1605+
100885707,Suma Bac D10 Sanitizer 2x5L GB,IRL
101103083,Suma Nova L6L 2x5L GB,I,IRL
7010160,Suma Rinse A5 2x5L W1886+
100873427,Suma Shine K2 10Kg W3350
101107213,Suma Scale D5.2 2x5L W1779
7513553,Suma Inox D7.1 6x0.75L W207
7511933,Suma Light D1.2 6x1L W3424
101102291,Cif PF.Oven&Grill Cl.6x0.75L W484
101104731,Bryta 5in1 DishwasherTabs 4x120pc GB,IRL
100941436,DI Oxivir Excel 2x5L W396
7516770,Good Sense Breakdown 2x5L W1779
101105070,Shield 3 Way Toilet Cleaner 12x1L GB,IRL
100955181,Shield Limescale Remover 12x1L GB,IRL
100987458,Room Care R5.1-plus 2x1.5L W207
100829788,Room Care R8 6x0.75L W3863
101107893,TASKI Sani MouldOut 6x0.75L W469
411090,Enhance Spot&Stain 6x0.75L GB,IRL X
411100,Enhance Extraction Clnr 2x5L GB,IRL X
7509661,Room Care R4 6x0.75L W2
7512374,TASKI Tapi Gum 6x0.5L W1
7513050,TASKI Sprint Glass 6x0.75L W561
6000832,Horizon Light 10L GB,IRL
7515126,Horizon Bright 10L GB,IRL
101108143,Comfort PF.Blue Skies Conc 10L GB,IRL
7522906,Horizon Bio 8.4Kg GB,IRL
6973314,Clax Peroxy 43B1 10Kg W3660`.split('\\n');

/* ===========================================================
   Build Ecoshot table
   =========================================================== */
function renderEco(){
  const tbody=document.getElementById('ecoTable');
  tbody.innerHTML='';
  ecoDefaults.forEach(row=>addEcoRow(row));
}
function addEcoRow(data={}){
  const tbody=document.getElementById('ecoTable');
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input class="form-control form-control-sm" value="${data.loc||''}"></td>
    <td><input class="form-control form-control-sm" value="${data.prod||''}"></td>
    <td><input class="form-control form-control-sm" type="number" value="${data.b||''}"></td>
    <td><input class="form-control form-control-sm" type="number" value="${data.bucket||''}"></td>`;
  tbody.appendChild(tr);
}

/* ===========================================================
   Dishwasher records
   =========================================================== */
function addDishRecord(data={}){
  const wrap=document.getElementById('dishList');
  const card=document.createElement('div');
  card.className='card mb-3';
  card.innerHTML=`
    <div class="card-body p-3">
      <div class="d-flex justify-content-between">
        <h6 class="card-title mb-2">Dishwasher</h6>
        <button class="btn btn-sm btn-outline-danger" onclick="this.closest('.card').remove()">Remove</button>
      </div>
      <div class="row g-2">
        <div class="col-6"><input class="form-control dish-loc" placeholder="Location" value="${data.loc||''}"></div>
        <div class="col-6"><input class="form-control dish-titr" placeholder="Titration result" value="${data.titr||''}"></div>
        <div class="col-6"><input class="form-control dish-wh" placeholder="Water hardness" value="${data.wh||''}"></div>
        <div class="col-6"><input class="form-control" type="file" accept="image/*"></div>
      </div>
      <textarea class="form-control mt-2 dish-cmt" rows="2" placeholder="Comments">${data.cmt||''}</textarea>
    </div>`;
  wrap.appendChild(card);
}

/* ===========================================================
   Stock table
   =========================================================== */
function renderStock(){
  const tbody=document.querySelector('#stockTable tbody');
  tbody.innerHTML='';
  stockList.forEach(line=>{
    const [sku,desc]=line.split(',');
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${sku}</td>
      <td>${desc}</td>
      <td><input class="form-control form-control-sm text-end" style="min-width:60px" type="number" min="0"></td>`;
    tbody.appendChild(tr);
  });
}

/* ===========================================================
   Stock copy / download
   =========================================================== */
function copyStock(){
  const rows=[...document.querySelectorAll('#stockTable tbody tr')];
  const txt=rows.map(r=>{
    const sku=r.cells[0].textContent.trim();
    const desc=r.cells[1].textContent.trim();
    const qty=r.querySelector('input').value||'';
    return `${sku}\\t${desc}\\t${qty}`;
  }).join('\\n');
  navigator.clipboard.writeText(txt).then(()=>alert('Stock list copied to clipboard.'));
}

function downloadCSV(){
  const rows=[...document.querySelectorAll('#stockTable tbody tr')];
  const csv=rows.map(r=>{
    const sku=r.cells[0].textContent.trim();
    const desc=r.cells[1].textContent.trim().replace(/"/g,'""');
    const qty=r.querySelector('input').value||'';
    return `"${sku}","${desc}","${qty}"`;
  }).join('\\n');
  const a=document.createElement('a');
  a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download='stock_count.csv';
  a.click();
}

/* ===========================================================
   Q&A summary
   =========================================================== */
function yesNo(b){return b?'Yes':'No';}

function buildQASummary(){
  let out=[];
  // Chemical Dispensing
  out.push('=== Chemical Dispensing Equipment ===');
  out.push('All dosing equipment functioning: '+yesNo(document.getElementById('doseOK').checked));
  const quat=document.getElementById('quat').value.trim();
  if(quat) out.push('Quat test (D10) ppm result: '+quat);
  out.push('All chemicals on approved systems: '+yesNo(document.getElementById('approvedSystems').checked));
  out.push('Enhance via pelican pump: '+yesNo(document.getElementById('enhancePelican').checked));
  const chemC=document.getElementById('chemComments').value.trim();
  if(chemC) out.push('Comments: '+chemC);

  // Ecoshot rows
  out.push('\\n=== Ecoshot Dispensing Volumes ===');
  const ecoRows=[...document.querySelectorAll('#ecoTable tr')];
  ecoRows.forEach(tr=>{
    const [loc,prod,b,bucket]=[...tr.querySelectorAll('input')].map(i=>i.value.trim());
    if(loc||prod||b||bucket){
      out.push(`${loc||''} | ${prod||''} | Bottle:${b||'-'}ml | Bucket:${bucket||'-'}ml`);
    }
  });
  if(ecoRows.length===0) out.push('(no rows)');

  // Dishwashers
  out.push('\\n=== Dishwasher Titration & Water Hardness ===');
  const cards=[...document.querySelectorAll('#dishList .card')];
  if(cards.length===0){
    out.push('(none recorded)');
  }else{
    cards.forEach((c,i)=>{
      const loc=c.querySelector('.dish-loc').value.trim();
      const titr=c.querySelector('.dish-titr').value.trim();
      const wh=c.querySelector('.dish-wh').value.trim();
      const cmt=c.querySelector('.dish-cmt').value.trim();
      out.push(`Dishwasher ${i+1}: ${loc||'(no location)'}`);
      if(titr) out.push('  Titration: '+titr);
      if(wh)   out.push('  Water hardness: '+wh);
      if(cmt)  out.push('  Comments: '+cmt);
    });
  }

  // Laundry
  out.push('\\n=== Laundry Equipment & Dosing Monitoring ===');
  out.push('Laundry dosing units functioning: '+yesNo(document.getElementById('laundryUnitOK').checked));
  out.push('Dosing matches site water hardness: '+yesNo(document.getElementById('laundryDoseRight').checked));
  out.push('Water hardness checked / recorded: '+yesNo(document.getElementById('waterHardnessDone').checked));
  out.push('Wash count recorded / reset: '+yesNo(document.getElementById('washCountReset').checked));
  const lC=document.getElementById('laundryComments').value.trim();
  if(lC) out.push('Comments: '+lC);

  // We do NOT automatically include full stock list here (can be huge); note where to get it.
  out.push('\\n=== Storeroom Stock ===');
  out.push('Use the Stock tab ‚Üí Copy to Clipboard / Export CSV for full list.');
  // (optional: include non-zero qty lines below)
  const stockRows=[...document.querySelectorAll('#stockTable tbody tr')];
  const used=stockRows.filter(r=>r.querySelector('input').value.trim()!=='' && r.querySelector('input').value.trim()!=='0');
  if(used.length){
    out.push('Entered quantities:');
    used.forEach(r=>{
      const sku=r.cells[0].textContent.trim();
      const desc=r.cells[1].textContent.trim();
      const qty=r.querySelector('input').value.trim();
      out.push(`  ${sku} | ${desc} | Qty:${qty}`);
    });
  }
  return out.join('\\n');
}

function openQASummary(){
  const txt=buildQASummary();
  document.getElementById('qaText').value=txt;
  const modal=new bootstrap.Modal(document.getElementById('qaModal'));
  modal.show();
}

function copyQA(){
  const txt=document.getElementById('qaText').value;
  navigator.clipboard.writeText(txt).then(()=>{
    alert('Q&A summary copied to clipboard.');
  });
}

/* ===========================================================
   Init
   =========================================================== */
renderEco();
renderStock();
</script>
</body>
</html>